---
title: "Exploration of UN Data Using tidyverse"
output: html_notebook
---

```{r}
library(tidyverse)
```


1.	Using the `read_csv()` function, read the GDP dataset into your notebook as a tibble called `gdp_df`. After reading it in, inspect the first 10 rows and then inspect the last 10 rows. 

```{r}
gdp_df <- read.csv("../data/gdp_per_capita.csv")
```

```{r}
gdp_df |>
  head(10)
```

```{r}
gdp_df |> 
  tail(10)
```

2. Drop the 'Value Footnotes' column, and rename the remaining columns to 'Country', 'Year', and 'GDP_Per_Capita'.

```{r}
gdp_df <- gdp_df |> 
  select(!Value.Footnotes) |> 
  rename(Country = Country.or.Area, Gdp_Per_Capita = Value)
```

3. Which years are represented in this dataset? How many observations are there per year? Make a plot to view the number of observations per year.

```{r}
gdp_df |> 
  group_by(Year) |> 
  count()
```

```{r}
gdp_df |> 
  ggplot(aes(x = Year)) +
  geom_bar() +
  labs(title = "Number of Observations by Year")
```

4. How many countries are represented in this dataset? Which countries have the fewest observations?

```{r}
gdp_df |> 
  summarize(num_countries = n_distinct(Country))
```

```{r}
gdp_df |> 
  group_by(Country) |> 
  count()
```

5. Create a new dataframe by subsetting `gdp_df` to just the year 2014. Call this new dataframe `gdp_2014`.

```{r}
gdp_2014 <- gdp_df |> 
  filter(Year == 2014)
```

6. Use `summary` to find the summary statistics for GDP per capita in 2014. 

```{r}
gdp_2014 |> 
  summary(Gdp_Per_Capita)
```
7. Create a histogram of GDP Per Capita numbers for 2014 (you may wish to adjust the number of bins for your histogram).

```{r}
gdp_2014 |> 
  ggplot(aes(x = Gdp_Per_Capita)) +
  geom_histogram() +
  labs(title = "GRP Per Capita for 2014")
```

8. Find the top 5 counties and bottom 5 countries by GDP per capita in 2014.

```{r}
gdp_2014 |> 
  arrange(Gdp_Per_Capita) |> 
  top_n(5)
```
```{r}
gdp_2014 |> 
  arrange(desc(Gdp_Per_Capita)) |> 
  top_n(5)
```

9. Now, return to the full dataset, `gdp_df`. Pivot the data for 1990 and 2018 (using the tidyr `.pivot_wider()` method or another method) so that each row corresponds to a country, each column corresponds to a year, and the values in the table give the GDP_Per_Capita amount. Drop any rows that are missing values for either 1990 or 2018. Save the result to a dataframe named `gdp_pivoted`.

```{r}
gdp_pivoted <- gdp_df |> 
  filter(Year == 1990 | Year == 2018) |> 
  pivot_wider(names_from = Year,
              values_from = Gdp_Per_Capita) |> 
  drop_na()
```

10. Create a new column in `gdp_pivoted` named `Percent_Change`. This column should contain the percent change in GDP_Per_Capita from 1990 to 2018. Hint: Percent change is calculated as 100*(New Value - Old Value) / Old Value.

```{r}
gdp_pivoted <- gdp_pivoted |> 
  rowwise() |> 
  mutate(Percent_Change = 100 * (`2018` - `1990`) / `1990`) |> 
  ungroup()
```

11. How many countries experienced a negative percent change in GDP per capita from 1990 to 2018?

```{r}
gdp_pivoted |> 
  filter(Percent_Change < 0) |> 
  count()
```

12. Which country had the highest % change in GDP per capita? Create a line plot showing this country's GDP per capita for all years for which you have data. Put both line charts on the same plot.

```{r}
gdp_pivoted |> 
  arrange(desc(Percent_Change)) |> 
  head(1)
```

```{r}
gdp_df |> 
  filter(Country == "Equatorial Guinea") |> 
  ggplot(aes(x = Year, y = Gdp_Per_Capita)) +
  geom_line() +
  labs(title = "GDP of Equatorial Guinea 1990-2018")
```

